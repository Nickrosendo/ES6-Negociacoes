{"version":3,"sources":["../../app-es6/dao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","connection","store","_connection","_store","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","onerror","console","log","e","target","error","cursor","openCursor","negociacoes","atual","result","dado","value","push","_data","_quantidade","_valor","continue","clear"],"mappings":";;;;;;;;;;;;;;;AAAQA,gB,qBAAAA,U;;;;;;;;;;;;;;;;;;;;;+BAEKC,a;AACX,+BAAYC,UAAZ,EAAwBC,KAAxB,EAA+B;AAAA;;AAC7B,eAAKC,WAAL,GAAmBF,UAAnB;AACA,eAAKG,MAAL,GAAcF,KAAd;AACD;;;;mCAEQG,U,EAAY;AAAA;;AACnB,mBAAO,IAAIC,OAAJ,CAAa,UAACC,OAAD,EAAUC,MAAV,EAAsB;AACxC,kBAAIC,UAAU,MAAKN,WAAL,CAAiBO,WAAjB,CAA6B,CAAC,MAAKN,MAAN,CAA7B,EAA4C,WAA5C,EACXO,WADW,CACC,MAAKP,MADN,EAEXQ,GAFW,CAEPP,UAFO,CAAd;;AAIAI,sBAAQI,SAAR,GAAoB,aAAK;AACvBN;AACD,eAFD;;AAIAE,sBAAQK,OAAR,GAAkB,aAAK;AACrBC,wBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,uBAAO,yCAAP;AACD,eAHD;AAKD,aAdM,CAAP;AAeD;;;uCAEY;AAAA;;AAEX,mBAAO,IAAIF,OAAJ,CAAa,UAACC,OAAD,EAAUC,MAAV,EAAsB;;AAExC,kBAAIY,SAAS,OAAKjB,WAAL,CACVO,WADU,CACE,CAAC,OAAKN,MAAN,CADF,EACiB,WADjB,EAERO,WAFQ,CAEI,OAAKP,MAFT,EAGNiB,UAHM,EAAb;;AAMA,kBAAIC,cAAc,EAAlB;;AAEAF,qBAAOP,SAAP,GAAmB,aAAG;;AAEpB,oBAAIU,QAAQN,EAAEC,MAAF,CAASM,MAArB;;AAEA,oBAAGD,KAAH,EAAU;;AAER,sBAAIE,OAAOF,MAAMG,KAAjB;AACAJ,8BAAYK,IAAZ,CACE,IAAI5B,UAAJ,CACE0B,KAAKG,KADP,EAEEH,KAAKI,WAFP,EAGEJ,KAAKK,MAHP,CADF;;AAQAP,wBAAMQ,QAAN;AACD,iBAZD,MAYK;AACHxB,0BAAQe,WAAR;AACD;AACF,eAnBD;;AAqBAF,qBAAON,OAAP,GAAiB,aAAG;AAClBC,wBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,uBAAO,wCAAP;AACD,eAHD;AAID,aAnCM,CAAP;AAoCD;;;uCAEY;AAAA;;AACX,mBAAO,IAAIF,OAAJ,CAAa,UAACC,OAAD,EAAUC,MAAV,EAAsB;AACxC,kBAAIC,UAAU,OAAKN,WAAL,CAAiBO,WAAjB,CAA6B,CAAC,OAAKN,MAAN,CAA7B,EAA4C,WAA5C,EACXO,WADW,CACC,OAAKP,MADN,EAEX4B,KAFW,EAAd;;AAIAvB,sBAAQI,SAAR,GAAoB,aAAK;AACvBN,wBAAQ,oCAAR;AACD,eAFD;;AAIAE,sBAAQK,OAAR,GAAkB,aAAK;AACrBC,wBAAQC,GAAR,CAAYC,EAAEC,MAAF,CAASC,KAArB;AACAX,uBAAO,yCAAP;AACD,eAHD;AAKD,aAdM,CAAP;AAeD","file":"NegociacaoDao.js","sourcesContent":["import {Negociacao} from '../models/Negociacao'\r\n\r\nexport class NegociacaoDao {\r\n  constructor(connection, store) {\r\n    this._connection = connection;\r\n    this._store = store;\r\n  }\r\n\r\n  adiciona(negociacao) {\r\n    return new Promise( (resolve, reject ) => {\r\n      let request = this._connection.transaction([this._store], 'readwrite')\r\n        .objectStore(this._store)\r\n        .add(negociacao);\r\n\r\n      request.onsuccess = e => {\r\n        resolve();\r\n      }\r\n\r\n      request.onerror = e => {\r\n        console.log(e.target.error);\r\n        reject(\"Não foi possível adicionar a negociação\");\r\n      }\r\n\r\n    })\r\n  }\r\n\r\n  listaTodos() {\r\n\r\n    return new Promise( (resolve, reject ) => {\r\n      \r\n      let cursor = this._connection\r\n        .transaction([this._store], 'readwrite')\r\n          .objectStore(this._store)\r\n            .openCursor();\r\n      \r\n      \r\n      let negociacoes = [];\r\n\r\n      cursor.onsuccess = e=>{\r\n        \r\n        let atual = e.target.result;\r\n\r\n        if(atual) {\r\n          \r\n          let dado = atual.value;\r\n          negociacoes.push(\r\n            new Negociacao( \r\n              dado._data,\r\n              dado._quantidade,\r\n              dado._valor\r\n            )\r\n          );\r\n\r\n          atual.continue();\r\n        }else{\r\n          resolve(negociacoes);\r\n        }\r\n      };\r\n\r\n      cursor.onerror = e=>{\r\n        console.log(e.target.error);\r\n        reject(\"Não foi possível listar as negociações\");\r\n      }\r\n    });\r\n  }\r\n\r\n  apagaTodos() {\r\n    return new Promise( (resolve, reject ) => {\r\n      let request = this._connection.transaction([this._store], 'readwrite')\r\n        .objectStore(this._store)\r\n        .clear();\r\n\r\n      request.onsuccess = e => {\r\n        resolve(\"Negociações removidas com sucesso!\");\r\n      }\r\n\r\n      request.onerror = e => {\r\n        console.log(e.target.error);\r\n        reject(\"Não foi possível remover as negociações\");\r\n      }\r\n\r\n    })\r\n  }\r\n}"]}